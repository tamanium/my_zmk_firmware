# トラブル備忘録
## case 1 再ペアリングが不可となる
### 事象
1. キーボードをペアリングする
2. キーボードをデバイス削除（ペアリング解除）する
3. キーボードをペアリングする（<-ここで接続が失敗する）

### 解決策
- リセット用のfirmwareを書き込み、その後本来のfirmwareを書き込んだ
    
### 原因
　よくわからん

### 対策
- BT設定のデバイス削除（ペアリング解除）操作を行わない
- BT設定でデバイス削除したらFMの再インストールを行う
- FMをアップデート・再インストールする場合はリセット用FMを書き込んでから行うこと
- リセット用firmwareのソースを追加　ビルド時に左右シールドと共に生成される


## case 2 BT接続しているのにUSB接続によるキー入力がおこなわれる
### 事象
1. シールドをUSB接続する
2. キーボードをペアリングする
3. キー入力する（<-この入力はUSB接続）

### 試したこと（解決不可）
- .conf : CONFIG_USB=n
- .conf : CONFIG_ZMK_USB=n
- .keymap : &out OUT_TOGでキー出力接続を切り替える

### 解決策
1. USB端子以外から給電し、ホストとはBT接続のみの関係とする
2. USB端子から電源を供給する場合は、behaviorの&out OUT_XXXをキーに割り当てて、それを用いてBT接続を行う<br>
> このbehaviorによる接続変更はフラッシュに保存される
3. そもそもここら辺の話は[公式のページ](https://zmk.dev/docs/behaviors/outputs)に説明がある


### 原因
- BT,USB両方で接続した場合はUSB接続が優先される

### 対策
- USB接続が行われないように給電させる（NG...PCやスマホのUSBポートから給電）
- BT,USB両方で接続する場合は&out OUT_XXXのbehaviorをキーマップに割り当てる [参照ページ](https://zmk.dev/docs/behaviors/outputs)

## case 3 .confファイルの設定が反映されている気配なし
### 事象
1. .confに設定定数を定義する（例 CONFIG_USB, CONFIG_ZMK_USB, CONFIG_BT）
2. buildしてファームウェアを書き込む
3. 挙動をみる<-USBつかえたりBT接続したりと設定が反映されてない

### 試したこと（解決不可）
- 特になし

### 解決策
- 未解決
- 今のところデフォルトのキー入力機能しか使用しないので、このcaseは放置

### 原因
- 不明
